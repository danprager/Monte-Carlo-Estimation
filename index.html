<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo Estimation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .input-help {
            font-size: 13px;
            color: #888;
            margin-top: 4px;
        }
        
        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        #results {
            display: none;
            animation: slideIn 0.5s ease-out;
        }
        
        #results.show {
            display: block;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: scale(1.05);
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }
        
        h2 {
            color: #333;
            margin: 30px 0 15px 0;
            font-size: 22px;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .error {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            animation: shake 0.5s ease;
        }
        
        .error.show {
            display: block;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .info-box {
            background: #e8f4f8;
            border-radius: 6px;
            padding: 15px;
            font-size: 14px;
            color: #0c5460;
            margin-top: 20px;
        }
        
        .attribution {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .attribution a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }
        
        .attribution a:hover {
            text-decoration: underline;
        }
        
        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 300px;
                padding: 10px;
            }
        }
        
        /* Print styles */
        @media print {
            body {
                background: white;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
            
            button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>Monte Carlo Estimation <span class="badge">v2.0</span></h1>
            <p class="subtitle">Probabilistic project forecasting using historical data</p>
            
            <div class="error" id="error"></div>
            
            <div class="form-group">
                <label for="past">Completed <b>stories</b> in past <b>sprints</b> [or whatever*]:</label>
                <input type="text" id="past" value="5 7 11 12 4 7" placeholder="e.g., 5 7 11 12 4 7">
                <div class="input-help">Enter numbers separated by spaces or commas</div>
            </div>
            
            <div class="form-group">
                <label for="size">Project size (number of stories):</label>
                <input type="number" id="size" value="50" min="1" max="1000" placeholder="50">
                <div class="input-help">Total stories in your backlog</div>
            </div>
            
            <button id="runBtn">
                <span id="btnText">Perform 10,000 simulations</span>
            </button>
            
            <div class="info-box">
                <strong>ðŸ’¡*Note:</strong> You can think in different <b>units</b> if you prefer, e.g. <i>story points</i> or <i>tasks</i> instead of <b>stories</b>, <i>weeks</i> or even <i>days</i> instead of <b>sprints</b>.
            </div>
        </div>
        
        <div class="card" id="results">
            <h1>Results</h1>
            
            <div class="results-grid">
                <div class="stat-card">
                    <div class="stat-label">Full Range</div>
                    <div class="stat-value" id="rangeText">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">90% Confidence</div>
                    <div class="stat-value" id="confidenceText">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Median</div>
                    <div class="stat-value" id="medianText">-</div>
                </div>
            </div>
            
            <h2>Will it be Done by Sprint X?</h2>
            <div class="chart-container">
                <canvas id="chart"></canvas>
            </div>
            
            <div class="info-box" style="margin-top: 20px;">
                <strong>ðŸ’¡ How to read this chart:</strong> Find a sprint count on the x-axis, look up to the curve, then across to the y-axis to see the probability of completing by that sprint.
            </div>
        </div>
        
        <div class="attribution">
            <h2 style="margin-top: 0;">About This Tool</h2>
            <p style="margin-bottom: 15px;">Monte Carlo simulation uses random sampling from historical data to predict future outcomes. This tool runs 10,000 simulations of your project, each time randomly selecting sprint velocities from your past performance to estimate completion time.</p>
            
            <p><strong>Created by:</strong> <a href="https://www.linkedin.com/in/danielaprager/" target="_blank">Dan Prager</a> with contributions from <a href="https://www.linkedin.com/in/timnewbold/" target="_blank">Tim Newbold</a> and modernised with Claude Sonnet 4.5</p>
            
            <p style="margin-top: 15px;"><strong>November 2024 update:</strong> Rebuilt with vanilla JavaScript, Chart.js, and responsive design</p>
            
            <p style="margin-top: 15px;">
                <strong>GitHub:</strong> <a href="https://github.com/danprager/Monte-Carlo-Estimation" target="_blank">github.com/danprager/Monte-Carlo-Estimation</a>
            </p>
            
            <p style="margin-top: 15px; font-size: 12px;">
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
                    <img alt="Creative Commons License" style="border-width:0; vertical-align: middle;" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
                </a>
                Licensed under Creative Commons Attribution-ShareAlike 4.0 International License
            </p>
        </div>
    </div>

    <!-- Chart.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

    <script>
        let chartInstance = null;

        // Utility: Parse input string to array of numbers
        function parseSprintData(input) {
            return input
                .replace(/,/g, ' ')
                .split(/\s+/)
                .map(s => parseInt(s, 10))
                .filter(n => !isNaN(n) && n > 0);
        }

        // Utility: Random choice from array
        function randomChoice(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        // Core simulation: How many sprints to complete a project?
        function simulateProject(totalStories, pastSprints) {
            let remainingStories = totalStories;
            let sprintsNeeded = 0;
            
            while (remainingStories > 0) {
                const storiesCompleted = randomChoice(pastSprints);
                
                if (storiesCompleted >= remainingStories) {
                    sprintsNeeded += remainingStories / storiesCompleted;
                    remainingStories = 0;
                } else {
                    sprintsNeeded += 1;
                    remainingStories -= storiesCompleted;
                }
            }
            
            return sprintsNeeded;
        }

        // Run Monte Carlo simulation
        function runMonteCarloSimulation(projectSize, pastSprints, numRuns = 10000) {
            const results = [];
            
            for (let i = 0; i < numRuns; i++) {
                results.push(simulateProject(projectSize, pastSprints));
            }
            
            results.sort((a, b) => a - b);
            
            return results;
        }

        // Calculate statistics from sorted results
        function calculateStats(sortedResults) {
            const getPercentile = (p) => {
                const index = Math.floor(sortedResults.length * p);
                return Math.round(sortedResults[index] * 10) / 10;
            };
            
            return {
                min: getPercentile(0),
                max: Math.round(sortedResults[sortedResults.length - 1] * 10) / 10,
                median: getPercentile(0.5),
                lower90: getPercentile(0.05),
                upper90: getPercentile(0.95)
            };
        }

        // Prepare chart data from simulation results
        function prepareChartData(sortedResults) {
            const data = [];
            const totalResults = sortedResults.length;
            
            // Sample every 100th point for performance
            for (let i = 0; i < totalResults; i += 100) {
                const sprints = sortedResults[i];
                const probability = (i / totalResults) * 100;
                data.push({ x: sprints, y: probability });
            }
            
            // Always include the final point
            data.push({ 
                x: sortedResults[totalResults - 1], 
                y: 100 
            });
            
            return data;
        }

        // Create or update chart
        function displayChart(sortedResults, stats) {
            const ctx = document.getElementById('chart').getContext('2d');
            const chartData = prepareChartData(sortedResults);
            
            // Destroy existing chart if it exists
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Cumulative Probability',
                        data: chartData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: {
                                size: 14
                            },
                            bodyFont: {
                                size: 13
                            },
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.y.toFixed(1)}% chance of completing in ${context.parsed.x.toFixed(1)} sprints or less`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Number of Sprints',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                stepSize: 1
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Probability of Completion (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            min: 0,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
        }

        // Display results with animation
        function displayResults(stats, sortedResults) {
            // Animate numbers counting up
            const animateValue = (elementId, end, suffix = ' sprints') => {
                const element = document.getElementById(elementId);
                const duration = 800;
                const start = 0;
                const startTime = performance.now();
                
                const animate = (currentTime) => {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const current = start + (end - start) * progress;
                    
                    if (typeof end === 'string') {
                        element.textContent = end;
                    } else {
                        element.textContent = current.toFixed(1) + suffix;
                    }
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                
                requestAnimationFrame(animate);
            };
            
            animateValue('rangeText', `${stats.min} â€“ ${stats.max} sprints`);
            animateValue('confidenceText', `${stats.lower90} â€“ ${stats.upper90} sprints`);
            animateValue('medianText', stats.median);
            
            displayChart(sortedResults, stats);
            
            document.getElementById('results').classList.add('show');
            
            // Smooth scroll to results
            setTimeout(() => {
                document.getElementById('results').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest' 
                });
            }, 100);
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = 'âš ï¸ ' + message;
            errorDiv.classList.add('show');
            setTimeout(() => errorDiv.classList.remove('show'), 5000);
        }

        // Hide results when inputs change
        function hideResults() {
            document.getElementById('results').classList.remove('show');
        }

        // Main execution
        document.getElementById('runBtn').addEventListener('click', function() {
            const pastSprintsInput = document.getElementById('past').value;
            const projectSize = parseInt(document.getElementById('size').value, 10);
            
            const pastSprints = parseSprintData(pastSprintsInput);
            
            // Validate inputs
            if (pastSprints.length === 0) {
                showError('Please enter at least one valid sprint completion number.');
                return;
            }
            
            if (isNaN(projectSize) || projectSize < 1) {
                showError('Please enter a valid project size (at least 1 story).');
                return;
            }
            
            // Run simulation with loading state
            const button = document.getElementById('runBtn');
            const btnText = document.getElementById('btnText');
            button.disabled = true;
            btnText.innerHTML = '<span class="spinner"></span>Running simulation...';
            
            setTimeout(() => {
                const results = runMonteCarloSimulation(projectSize, pastSprints);
                const stats = calculateStats(results);
                
                displayResults(stats, results);
                
                button.disabled = false;
                btnText.textContent = 'Perform 10,000 simulations';
            }, 10);
        });

        // Hide results when inputs change
        document.getElementById('past').addEventListener('input', hideResults);
        document.getElementById('size').addEventListener('input', hideResults);
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                document.getElementById('runBtn').click();
            }
        });
    </script>
</body>
</html>
